<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>แบบทดสอบการเลือกสวิตช์ไฟ</title>
  <style>
    body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: linear-gradient(135deg, #74ebd5, #9face6);
}
    .container { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    h2 { margin-top:0; }
    .section { display:none; }
    .section.active { display:block; }
    label { display:block; margin-top:10px; }
    input, select, button { margin-top:5px; padding:8px; }
    .center { text-align:center; }
    .images { display:flex; justify-content:space-around; margin:20px 0; }
    .images img { width:45%; border:1px solid #ccc; border-radius:6px; }
    .switches button { width:45%; margin:10px; }
  </style>
</head>
<body>
<div class="container">

  <h1 style="text-align:center; margin-bottom:10px;">
    แบบสำรวจการใช้งานสวิตซ์ไฟ
  </h1>
  <!-- ส่วนที่ 1 ข้อมูลผู้เข้าทดสอบ -->
  <div id="section1" class="section active">
    <h2>ส่วนที่ 1 ข้อมูลผู้เข้าทดสอบ</h2>
    <label>ชื่อเล่น <input type="text" id="name"></label>
    <label>เพศ
      <select id="gender">
        <option value="">-- เลือก --</option>
        <option>ชาย</option>
        <option>หญิง</option>
        <option>อื่น ๆ</option>
      </select>
    </label>
    <label>ช่วงอายุ
      <select id="age">
        <option value="">-- เลือก --</option>
        <option>ต่ำกว่า 20 ปี</option>
        <option>20–22 ปี</option>
        <option>23–25 ปี</option>
        <option>มากกว่า 25 ปี</option>
      </select>
    </label>
    <label>สถานภาพในมหาวิทยาลัย
      <select id="status">
        <option>นักศึกษา</option>
        <option>อาจารย์</option>
        <option>บุคลากร</option>
      </select>
    </label>
    <label>เคยใช้งานสถานที่นี้หรือไม่
      <select id="experience">
        <option>เคย</option>
        <option>ไม่เคย</option>
      </select>
    </label>
    <button onclick="startIntro()">เริ่มการทดสอบ</button>
  </div>

  <!-- ส่วนที่ 2 คำแนะนำ -->
  <div id="section2" class="section center">
    <h2>คำแนะนำ</h2>
    <p>เลือกสวิตช์ไฟที่ใช้เปิดไฟในตำแหน่งที่กำหนด</p>
    <p>เริ่มทดสอบใน <span id="countdown">3</span></p>
  </div>

  <!-- ส่วนที่ 3 คำถาม -->
  <div id="section3" class="section center">
    <h2 id="questionText"></h2>

    <div class="images">
      <img id="imgA" src="" alt="ภาพที่ 1">
      <img id="imgB" src="" alt="ภาพที่ 2">
    </div>

    <div class="switches">
      <button onclick="answer(1)">สวิตช์ที่ 1</button>
      <button onclick="answer(2)">สวิตช์ที่ 2</button>
      <button onclick="answer(3)">สวิตช์ที่ 3</button>
      <button onclick="answer(4)">สวิตช์ที่ 4</button>
    </div>
  </div>

  <!-- ส่วนที่ 4 ผลลัพธ์ -->
  <div id="section4" class="section center">
    <h2>ผลการทดสอบ</h2>
    <div id="result"></div>
  </div>

</div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbygKP72uVInedOAAh0RatE1jZNWcIKWc5rxRZ9l6A2I2lKmGq5lIDD1GAvYJWMU5g8FVQ/exec";
  const questions = [
    { text: 'ข้อที่ 1: ถ้าอยากเปิดไฟตำแหน่ง A ต้องกดสวิตช์ใด', img1: 'A1.png', img2: 'A2.png' },
    { text: 'ข้อที่ 2: ถ้าอยากเปิดไฟตำแหน่ง B ต้องกดสวิตช์ใด', img1: 'B1.png', img2: 'B2.png' },
    { text: 'ข้อที่ 3: ถ้าอยากเปิดไฟตำแหน่ง C ต้องกดสวิตช์ใด', img1: 'C1.png', img2: 'C2.png' },
    { text: 'ข้อที่ 4: ถ้าอยากเปิดไฟตำแหน่ง D ต้องกดสวิตช์ใด', img1: 'D1.png', img2: 'D2.png' }
  ];

  let current = 0;
  let startTime;
  let times = [];

  function startIntro() {
    section1.classList.remove('active');
    section2.classList.add('active');
    let c = 3;
    const cd = document.getElementById('countdown');
    const t = setInterval(() => {
      c--; cd.textContent = c;
      if (c === 0) { clearInterval(t); startTest(); }
    }, 1000);
  }

  function startTest() {
    section2.classList.remove('active');
    section3.classList.add('active');
    loadQuestion();
  }

  function loadQuestion() {
    const q = questions[current];
    document.getElementById('questionText').textContent = q.text;
    document.getElementById('imgA').src = q.img1;
    document.getElementById('imgB').src = q.img2;
    startTime = new Date().getTime();
  }

  function answer(choice) {
    const end = new Date().getTime();
    times.push({ question: current + 1, choice, time: ((end - startTime)/1000).toFixed(2) });
    current++;

    if (current < questions.length) {
      loadQuestion();
    } else {
      showResult();
    }
  }

  function showResult() {
  section3.classList.remove('active');
  section4.classList.add('active');

  let html = '';
  times.forEach(t => {
    html += `ข้อ ${t.question} เลือกสวิตช์ ${t.choice} ใช้เวลา ${t.time} วินาที<br>`;
  });
  document.getElementById('result').innerHTML = html;

  // ✅ STEP 5: ส่งข้อมูลไป Google Sheets
  sendToGoogleSheet();
}
  function sendToGoogleSheet() {
  const payload = {
    name: document.getElementById('name').value,
    gender: document.getElementById('gender').value,
    age: document.getElementById('age').value,
    status: document.getElementById('status').value,
    experience: document.getElementById('experience').value,
    answers: times
  };

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(payload),
    headers: {
      "Content-Type": "application/json"
    }
  })
  .then(res => res.text())
  .then(txt => console.log("ส่งข้อมูลแล้ว:", txt))
  .catch(err => console.error("ส่งไม่สำเร็จ:", err));
}
</script>
</body>
</html>
